
<!--https://github.com/ruffle-rs/ruffle/blob/master/web/packages/selfhosted/README.md#javascript-api-->

<!--
input: src is_broadway
-->

<div id="container"></div>
<script>
	const ext_id='accciaopdflbajjpfojgijjddpgopbdm';
	let player;
	let port;
	function go(){
		player.removeEventListener('loadedmetadata',go);
		const oldConsole = {};
		oldConsole.log = console.log;
		console.log= function (arg) {
			port.postMessage({text:arg});
			oldConsole.log(arg);
		}
		player.style.width=player.metadata.width;
		player.style.height=player.metadata.height;
	}
	function begin(){//recv oadbg connected
		port.onMessage.removeListener(begin);
		player.addEventListener('loadedmetadata', go);
		player.load("/a/universe/universe.swf");
	}
	window.addEventListener("DOMContentLoaded", () => {
		window.RufflePlayer.config = {
			"logLevel": "debug"
		};
		const ruffle = window.RufflePlayer.newest();
		const container = document.getElementById("container");
		player = ruffle.createPlayer();
		container.appendChild(player);

		const queryString = self.location.search;//tab.url.split('?')[1]
		const urlParams = new URLSearchParams(queryString);
		const is_broadway = urlParams.keys().next().value;

		port = chrome.runtime.connect(ext_id);
		port.onMessage.addListener(begin);
		port.postMessage({text:is_broadway});//send arguments
	});
</script>

<script src="/dist/ruffle.js">
// file:// will not work, there is a graphical information at runtime with the player about this
</script>
